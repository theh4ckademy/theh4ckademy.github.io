{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\ud83c\uddeb\ud83c\uddf7 Version fran\u00e7aise | \ud83c\uddec\ud83c\udde7 English version English Welcome to TheH4ckademy , the platform dedicated to cybersecurity enthusiasts! Here, you\u2019ll find complete CTF write-ups ( Capture The Flag ), organized by category, difficulty level, and events. \ud83d\ude80 About TheH4ckademy was created to support students, curious minds, and professionals in their journey into ethical hacking . Each write-up aims to demystify challenges by explaining the logic behind the solutions, with screenshots, source code, and practical tips. This project was born from the passion of two cybersecurity enthusiasts, eager to bring clarity and rigor to the learning process in this field. \ud83d\udcda Site Content Realistic CTF boxes More content coming soon Each write-up includes: \ud83d\udcdd A description of the challenge \ud83e\udde0 The reasoning used to approach it \u2699\ufe0f Step-by-step resolution \ud83d\udca1 Helpful tips and techniques \ud83d\udcce Associated files (if any) \ud83c\udf10 Platform Access \ud83d\udd17 TheH4ckademy \ud83e\udded Navigation The navigation bar allows you to browse challenges by platform , then by name . For event-based challenges, they are organized by type within each event. Example: TryHackMe \u2192 Ledger \ud83d\udc68\u200d\ud83d\udcbb About the Authors Developed and maintained by Anthony KOUROGHLI (anthkrg) and Bastien LEJARS (pudwill) \ud83d\udceb Contact: [theh4ckademy@gmail.com] \ud83d\udd17 GitHub - TheH4ckademy \u26a0\ufe0f Disclaimer This site is intended solely for the ethical learning of cybersecurity. The techniques presented must never be used for illegal purposes. The authors disclaim all responsibility for any misuse of the information provided. \u2b50 Support the Project! If you enjoy the content, feel free to share the platform with others \ud83d\ude4c Fran\u00e7ais Bienvenue sur TheH4ckademy , la plateforme d\u00e9di\u00e9e aux passionn\u00e9s de cybers\u00e9curit\u00e9 ! Vous y trouverez des write-ups complets de CTF ( Capture The Flag ), organis\u00e9s par cat\u00e9gories, niveaux de difficult\u00e9 et \u00e9v\u00e9nements. \ud83d\ude80 \u00c0 propos TheH4ckademy a \u00e9t\u00e9 cr\u00e9\u00e9 pour accompagner les \u00e9tudiants, les curieux et les professionnels dans leur progression dans le domaine du hacking \u00e9thique . Chaque write-up vise \u00e0 d\u00e9mystifier les challenges en expliquant la logique de r\u00e9solution, avec des captures d\u2019\u00e9cran, du code source et des conseils pratiques. Ce projet est n\u00e9 de la passion de deux enthousiastes de cybers\u00e9curit\u00e9, souhaitant apporter de la clart\u00e9 et de la rigueur dans l'apprentissage de cette discipline. \ud83d\udcda Contenu du site Boxes CTF r\u00e9alistes Autres contenus \u00e0 venir Chaque write-up comprend : \ud83d\udcdd Une description du challenge \ud83e\udde0 Le raisonnement suivi pour l\u2019aborder \u2699\ufe0f Les \u00e9tapes de r\u00e9solution d\u00e9taill\u00e9es \ud83d\udca1 Des conseils et techniques utiles \ud83d\udcce Les fichiers associ\u00e9s (le cas \u00e9ch\u00e9ant) \ud83c\udf10 Acc\u00e8s \u00e0 la plateforme \ud83d\udd17 TheH4ckademy \ud83e\udded Navigation La barre de navigation vous permet de parcourir les challenges par plateforme , puis par nom . Pour les challenges issus d\u2019\u00e9v\u00e9nements, ils sont class\u00e9s par type au sein de chaque \u00e9v\u00e9nement. Exemple : TryHackMe \u2192 Ledger \ud83d\udc68\u200d\ud83d\udcbb \u00c0 propos des auteurs D\u00e9velopp\u00e9 et maintenu par Anthony KOUROGHLI (anthkrg) et Bastien LEJARS (pudwill) \ud83d\udceb Contact : [theh4ckademy@gmail.com] \ud83d\udd17 GitHub - TheH4ckademy \u26a0\ufe0f Disclaimer Ce site est destin\u00e9 exclusivement \u00e0 l\u2019apprentissage \u00e9thique de la cybers\u00e9curit\u00e9. Les techniques pr\u00e9sent\u00e9es ne doivent en aucun cas \u00eatre utilis\u00e9es dans un cadre ill\u00e9gal. Les auteurs d\u00e9clinent toute responsabilit\u00e9 en cas d\u2019usage abusif des informations diffus\u00e9es. \u2b50 Soutenez le projet ! Si vous appr\u00e9ciez le contenu, n\u2019h\u00e9sitez pas \u00e0 partager la plateforme autour de vous \ud83d\ude4c","title":"\ud83e\udde0 TheH4ckademy"},{"location":"#english","text":"Welcome to TheH4ckademy , the platform dedicated to cybersecurity enthusiasts! Here, you\u2019ll find complete CTF write-ups ( Capture The Flag ), organized by category, difficulty level, and events.","title":"English"},{"location":"#about","text":"TheH4ckademy was created to support students, curious minds, and professionals in their journey into ethical hacking . Each write-up aims to demystify challenges by explaining the logic behind the solutions, with screenshots, source code, and practical tips. This project was born from the passion of two cybersecurity enthusiasts, eager to bring clarity and rigor to the learning process in this field.","title":"\ud83d\ude80 About"},{"location":"#site-content","text":"Realistic CTF boxes More content coming soon Each write-up includes: \ud83d\udcdd A description of the challenge \ud83e\udde0 The reasoning used to approach it \u2699\ufe0f Step-by-step resolution \ud83d\udca1 Helpful tips and techniques \ud83d\udcce Associated files (if any)","title":"\ud83d\udcda Site Content"},{"location":"#platform-access","text":"\ud83d\udd17 TheH4ckademy","title":"\ud83c\udf10 Platform Access"},{"location":"#navigation","text":"The navigation bar allows you to browse challenges by platform , then by name . For event-based challenges, they are organized by type within each event. Example: TryHackMe \u2192 Ledger","title":"\ud83e\udded Navigation"},{"location":"#about-the-authors","text":"Developed and maintained by Anthony KOUROGHLI (anthkrg) and Bastien LEJARS (pudwill) \ud83d\udceb Contact: [theh4ckademy@gmail.com] \ud83d\udd17 GitHub - TheH4ckademy","title":"\ud83d\udc68\u200d\ud83d\udcbb About the Authors"},{"location":"#disclaimer","text":"This site is intended solely for the ethical learning of cybersecurity. The techniques presented must never be used for illegal purposes. The authors disclaim all responsibility for any misuse of the information provided.","title":"\u26a0\ufe0f Disclaimer"},{"location":"#support-the-project","text":"If you enjoy the content, feel free to share the platform with others \ud83d\ude4c","title":"\u2b50 Support the Project!"},{"location":"#francais","text":"Bienvenue sur TheH4ckademy , la plateforme d\u00e9di\u00e9e aux passionn\u00e9s de cybers\u00e9curit\u00e9 ! Vous y trouverez des write-ups complets de CTF ( Capture The Flag ), organis\u00e9s par cat\u00e9gories, niveaux de difficult\u00e9 et \u00e9v\u00e9nements.","title":"Fran\u00e7ais"},{"location":"#a-propos","text":"TheH4ckademy a \u00e9t\u00e9 cr\u00e9\u00e9 pour accompagner les \u00e9tudiants, les curieux et les professionnels dans leur progression dans le domaine du hacking \u00e9thique . Chaque write-up vise \u00e0 d\u00e9mystifier les challenges en expliquant la logique de r\u00e9solution, avec des captures d\u2019\u00e9cran, du code source et des conseils pratiques. Ce projet est n\u00e9 de la passion de deux enthousiastes de cybers\u00e9curit\u00e9, souhaitant apporter de la clart\u00e9 et de la rigueur dans l'apprentissage de cette discipline.","title":"\ud83d\ude80 \u00c0 propos"},{"location":"#contenu-du-site","text":"Boxes CTF r\u00e9alistes Autres contenus \u00e0 venir Chaque write-up comprend : \ud83d\udcdd Une description du challenge \ud83e\udde0 Le raisonnement suivi pour l\u2019aborder \u2699\ufe0f Les \u00e9tapes de r\u00e9solution d\u00e9taill\u00e9es \ud83d\udca1 Des conseils et techniques utiles \ud83d\udcce Les fichiers associ\u00e9s (le cas \u00e9ch\u00e9ant)","title":"\ud83d\udcda Contenu du site"},{"location":"#acces-a-la-plateforme","text":"\ud83d\udd17 TheH4ckademy","title":"\ud83c\udf10 Acc\u00e8s \u00e0 la plateforme"},{"location":"#navigation_1","text":"La barre de navigation vous permet de parcourir les challenges par plateforme , puis par nom . Pour les challenges issus d\u2019\u00e9v\u00e9nements, ils sont class\u00e9s par type au sein de chaque \u00e9v\u00e9nement. Exemple : TryHackMe \u2192 Ledger","title":"\ud83e\udded Navigation"},{"location":"#a-propos-des-auteurs","text":"D\u00e9velopp\u00e9 et maintenu par Anthony KOUROGHLI (anthkrg) et Bastien LEJARS (pudwill) \ud83d\udceb Contact : [theh4ckademy@gmail.com] \ud83d\udd17 GitHub - TheH4ckademy","title":"\ud83d\udc68\u200d\ud83d\udcbb \u00c0 propos des auteurs"},{"location":"#disclaimer_1","text":"Ce site est destin\u00e9 exclusivement \u00e0 l\u2019apprentissage \u00e9thique de la cybers\u00e9curit\u00e9. Les techniques pr\u00e9sent\u00e9es ne doivent en aucun cas \u00eatre utilis\u00e9es dans un cadre ill\u00e9gal. Les auteurs d\u00e9clinent toute responsabilit\u00e9 en cas d\u2019usage abusif des informations diffus\u00e9es.","title":"\u26a0\ufe0f Disclaimer"},{"location":"#soutenez-le-projet","text":"Si vous appr\u00e9ciez le contenu, n\u2019h\u00e9sitez pas \u00e0 partager la plateforme autour de vous \ud83d\ude4c","title":"\u2b50 Soutenez le projet !"},{"location":"TryHackMe/ledger/","text":"\ud83c\uddeb\ud83c\uddf7 Version fran\u00e7aise | \ud83c\uddec\ud83c\udde7 English version English Category: Active Directory Platform: TryHackMe Goal: The Ledger machine simulates an Active Directory environment where the attacker must enumerate users via LDAP, exploit default passwords to gain an initial user foothold, and then escalate privileges by abusing a misconfiguration in Active Directory Certificate Services (ADCS). The final objective is to obtain a certificate that allows authentication as Administrator . 1. Nmap Scan \u2013 What does the infrastructure hold? Before jumping into the flashy tools, we keep it classic: a good old Nmap scan to lay the foundation of our understanding. nmap -sC -sV -Pn -T4 -p- <IP> 1.1 Exegol-history exegol-history is a mechanism or module often used in the Exegol environment, a Docker offensive container designed for pentesters and Red Teamers. It allows customization of the working session in the container, notably by loading environment variables when opening an Exegol terminal. Its main benefit is the automatic pre-configuration of sensitive or useful variables for each engagement, such as: TARGET : name or IP of the target DOMAIN : Active Directory domain being attacked USERNAME : compromised account during the pentest PASSWORD : associated account password ... This avoids retyping them each time, allows use in scripts/tools (NetExec, Impacket, etc.), and standardizes environments across operators. \ud83d\udce1 Open Ports \u2013 Initial Analysis Here are the ports detected by Nmap, with a quick analysis of potential opportunities: Port Service Interpretation / Action 53 DNS \ud83d\udd0e Test for zone transfer 80 HTTP \ud83c\udf10 Web investigation (classic site?) 88 Kerberos \ud83d\udd13 ASREPRoasting if usernames are known 135 RPC \ud83d\udce4 Enumeration via rpcdump 139 NetBIOS \ud83d\udcc2 Enumeration with smbmap / enum4linux 445 SMB \ud83d\udcc2 Potential shares, rights, SMB enumeration 389 LDAP \ud83e\uddec ldapsearch to extract accounts 443 HTTPS \ud83c\udf10 Secure web version , worth checking out 3389 RDP \ud83d\udd10 Remote access if valid credentials exist We leak: - The Domain name --> thm.local - The machine's FQDN --> labyrinth.thm.local 2. DNS \u2013 Can we extract info easily? A little zone transfer test \u2014 often overlooked but sometimes quite revealing: \u274c Failed. No worries, let\u2019s hunt for intel elsewhere. 3. HTTP/HTTPS \u2013 Any hope on the web? We head to port 80 (HTTP) then 443 (HTTPS). The site shows a default IIS landing page. 4. SMB/RPC \u2013 Juicy shares? \u274c Nothing useful. Looks like authentication is required to get anything valuable. Let\u2019s revisit later. 5. LDAP \u2013 The Rare Gem? We grep the output with description Then, scrolling down a bit, we notice: We extract the users associated with this default password \ud83d\udca5 Bingo! Two users appear with the same default password: IVY_WILLIS SUSANNA_MCKNIGHT 6. RDP \u2013 A Gateway to the System? We test the possibility that the users found previously can connect via RDP: Then we connect with the user who can establish an RDP session with the machine We retrieve the user.txt flag 7. PrivEsc \u2013 Privilege Escalation via Certificates \ud83e\udde9 We explore the groups to which Susanna belongs and... oh: Certificate Service DCOM Access \ud83e\udde0 Think: Does this give you leverage over Windows certificate services? You might be able to request a machine authentication certificate... Using Certipy, a powerful tool for this universe: A vulnerable template is discovered! We then attempt: We obtain a certificate that allows us to authenticate as Administrator \ud83d\ude08 And there we have an Administrator TGT. The key to the kingdom. 8. Admin Connection \u2013 The Loop is Closed With a valid TGT, a wmiexec.py from Impacket gives us a direct shell as admin: And the Grail awaits us! Conclusion This challenge is an excellent example of a realistic Active Directory scenario: Passive reconnaissance (DNS, LDAP, Nmap) Exploitation of bad practices (default passwords) Escalation via ADCS (Active Directory Certificate Services) Fran\u00e7ais Cat\u00e9gorie : Active Directory Plateforme : TryHackMe Objectif : La machine Ledger simule un environnement Active Directory dans lequel l\u2019attaquant doit \u00e9num\u00e9rer des utilisateurs via LDAP, exploiter des mots de passe par d\u00e9faut pour obtenir un premier acc\u00e8s utilisateur, puis \u00e9lever ses privil\u00e8ges en abusant d\u2019une mauvaise configuration d\u2019Active Directory Certificate Services (ADCS). L\u2019objectif final est d\u2019obtenir un certificat permettant de s\u2019authentifier comme Administrator . 1. Scan Nmap \u2013 Que nous r\u00e9serve l'infrastructure ? Avant de sauter sur les outils les plus sexy, on reste sobre : un bon vieux scan Nmap pour poser les fondations de notre compr\u00e9hension. nmap -sC -sV -Pn -T4 -p- <IP> 1.1 Exegol-history exegol-history est un m\u00e9canisme ou module souvent utilis\u00e9 dans l\u2019environnement Exegol, un conteneur Docker offensif con\u00e7u pour les pentesters et Red Teamers. Il permet, entre autres, de personnaliser la session de travail dans le conteneur, notamment via le chargement de variables d\u2019environnement d\u00e8s l\u2019ouverture d\u2019un terminal Exegol. L\u2019int\u00e9r\u00eat principal est de pr\u00e9-configurer automatiquement des variables sensibles ou utiles \u00e0 chaque engagement, comme : TARGET : nom ou IP de la cible DOMAIN : domaine Active Directory attaqu\u00e9 USERNAME : compte compromis durant le pentest PASSWORD : mot de passe du compte associ\u00e9 ... Cela \u00e9vite de devoir les retaper \u00e0 chaque fois, permet de les utiliser dans des scripts ou des outils (NetExec, Impacket, etc.), et standardise l\u2019environnement d\u2019un op\u00e9rateur \u00e0 l\u2019autre. \ud83d\udce1 Ports ouverts \u2013 Analyse initiale Voici les ports d\u00e9tect\u00e9s par Nmap, avec une analyse rapide des opportunit\u00e9s potentielles : Port Service Interpr\u00e9tation / Action 53 DNS \ud83d\udd0e Zone transfer \u00e0 tester 80 HTTP \ud83c\udf10 Investigation web (site classique ?) 88 Kerberos \ud83d\udd13 ASREPRoasting si usernames connus 135 RPC \ud83d\udce4 Enum\u00e9ration via rpcdump 139 NetBIOS \ud83d\udcc2 Enum\u00e9ration avec smbmap / enum4linux 445 SMB \ud83d\udcc2 Possibles partages, droits, Enum SMB 389 LDAP \ud83e\uddec ldapsearch pour extraire des comptes 443 HTTPS \ud83c\udf10 Version s\u00e9curis\u00e9e du site , \u00e0 fouiller 3389 RDP \ud83d\udd10 Acc\u00e8s distant si compte valide On fuite: - Le Domain name --> thm.local - Le FQDN de la machine --> labyrinth.thm.local 2. DNS \u2013 Peut-on aspirer des infos facilement ? Un petit test de zone transfer, souvent n\u00e9glig\u00e9 mais parfois tr\u00e8s parlant : \u274c \u00c9chec. Pas grave, on poursuit notre chasse aux infos ailleurs. 3. HTTP/HTTPS \u2013 Espoir sur le web ? Direction le port 80 (HTTP) puis 443 (HTTPS). L\u2019acc\u00e8s renvoie une page par d\u00e9faut IIS. 4. SMB/RPC \u2013 Partages juteux ? \u274c Rien d\u2019exploitable. On dirait qu\u2019il faut \u00eatre authentifi\u00e9 pour obtenir quelque chose. Revenons plus tard. 5. LDAP \u2013 La perle rare ? On grep l'output avec description Puis en descendant un peu on remarque: On extrait les users associ\u00e9s \u00e0 ce mot de passe par d\u00e9faut \ud83d\udca5 Bingo ! Deux utilisateurs apparaissent avec le m\u00eame mot de passe par d\u00e9faut: IVY_WILLIS SUSANNA_MCKNIGHT 6. RDP \u2013 Une ouverture vers le syst\u00e8me ? On teste la possibilit\u00e9 que les users trouv\u00e9 pr\u00e9c\u00e9demment puissent se connecter en RDP: Puis on se connecte avec le user qui peut \u00e9tablir une session RDP avec la machine On r\u00e9cup\u00e8re le flag user.txt 7. PrivEsc \u2013 L\u2019escalade par les certificats \ud83e\udde9 On explore les groupes auxquels Susanna appartient et\u2026 oh : Certificate Service DCOM Access \ud83e\udde0 R\u00e9fl\u00e9chis : Cela te donne-t-il un levier sur les services de certificats Windows ? Tu peux peut-\u00eatre demander un certificat d\u2019authentification machine... Utilisation de Certipy, un outil redoutable pour cet univers : Un template vuln\u00e9rable est d\u00e9couvert ! On tente alors : On obtient un certificat qui permet de s\u2019authentifier comme Administrator \ud83d\ude08 Et voil\u00e0 un TGT Administrator en poche. La cl\u00e9 du royaume. 8. Connexion Admin \u2013 La boucle est boucl\u00e9e Avec un TGT valide, un wmiexec.py de Impacket nous donne un shell direct en tant qu\u2019admin : Et le Graal nous attend ! Conclusion Ce challenge est un excellent exemple d\u2019un sc\u00e9nario r\u00e9aliste d'Active Directory : Reconnaissance passive (DNS, LDAP, Nmap) Exploitation de mauvaises pratiques (mots de passe par d\u00e9faut) Escalade via ADCS (Active Directory Certificate Services)","title":"Ledger"},{"location":"TryHackMe/ledger/#english","text":"Category: Active Directory Platform: TryHackMe Goal: The Ledger machine simulates an Active Directory environment where the attacker must enumerate users via LDAP, exploit default passwords to gain an initial user foothold, and then escalate privileges by abusing a misconfiguration in Active Directory Certificate Services (ADCS). The final objective is to obtain a certificate that allows authentication as Administrator .","title":"English"},{"location":"TryHackMe/ledger/#1-nmap-scan-what-does-the-infrastructure-hold","text":"Before jumping into the flashy tools, we keep it classic: a good old Nmap scan to lay the foundation of our understanding. nmap -sC -sV -Pn -T4 -p- <IP>","title":"1. Nmap Scan \u2013 What does the infrastructure hold?"},{"location":"TryHackMe/ledger/#11-exegol-history","text":"exegol-history is a mechanism or module often used in the Exegol environment, a Docker offensive container designed for pentesters and Red Teamers. It allows customization of the working session in the container, notably by loading environment variables when opening an Exegol terminal. Its main benefit is the automatic pre-configuration of sensitive or useful variables for each engagement, such as: TARGET : name or IP of the target DOMAIN : Active Directory domain being attacked USERNAME : compromised account during the pentest PASSWORD : associated account password ... This avoids retyping them each time, allows use in scripts/tools (NetExec, Impacket, etc.), and standardizes environments across operators.","title":"1.1 Exegol-history"},{"location":"TryHackMe/ledger/#open-ports-initial-analysis","text":"Here are the ports detected by Nmap, with a quick analysis of potential opportunities: Port Service Interpretation / Action 53 DNS \ud83d\udd0e Test for zone transfer 80 HTTP \ud83c\udf10 Web investigation (classic site?) 88 Kerberos \ud83d\udd13 ASREPRoasting if usernames are known 135 RPC \ud83d\udce4 Enumeration via rpcdump 139 NetBIOS \ud83d\udcc2 Enumeration with smbmap / enum4linux 445 SMB \ud83d\udcc2 Potential shares, rights, SMB enumeration 389 LDAP \ud83e\uddec ldapsearch to extract accounts 443 HTTPS \ud83c\udf10 Secure web version , worth checking out 3389 RDP \ud83d\udd10 Remote access if valid credentials exist We leak: - The Domain name --> thm.local - The machine's FQDN --> labyrinth.thm.local","title":"\ud83d\udce1 Open Ports \u2013 Initial Analysis"},{"location":"TryHackMe/ledger/#2-dns-can-we-extract-info-easily","text":"A little zone transfer test \u2014 often overlooked but sometimes quite revealing: \u274c Failed. No worries, let\u2019s hunt for intel elsewhere.","title":"2. DNS \u2013 Can we extract info easily?"},{"location":"TryHackMe/ledger/#3-httphttps-any-hope-on-the-web","text":"We head to port 80 (HTTP) then 443 (HTTPS). The site shows a default IIS landing page.","title":"3. HTTP/HTTPS \u2013 Any hope on the web?"},{"location":"TryHackMe/ledger/#4-smbrpc-juicy-shares","text":"\u274c Nothing useful. Looks like authentication is required to get anything valuable. Let\u2019s revisit later.","title":"4. SMB/RPC \u2013 Juicy shares?"},{"location":"TryHackMe/ledger/#5-ldap-the-rare-gem","text":"We grep the output with description Then, scrolling down a bit, we notice: We extract the users associated with this default password \ud83d\udca5 Bingo! Two users appear with the same default password: IVY_WILLIS SUSANNA_MCKNIGHT","title":"5. LDAP \u2013 The Rare Gem?"},{"location":"TryHackMe/ledger/#6-rdp-a-gateway-to-the-system","text":"We test the possibility that the users found previously can connect via RDP: Then we connect with the user who can establish an RDP session with the machine We retrieve the user.txt flag","title":"6. RDP \u2013 A Gateway to the System?"},{"location":"TryHackMe/ledger/#7-privesc-privilege-escalation-via-certificates","text":"We explore the groups to which Susanna belongs and... oh: Certificate Service DCOM Access \ud83e\udde0 Think: Does this give you leverage over Windows certificate services? You might be able to request a machine authentication certificate... Using Certipy, a powerful tool for this universe: A vulnerable template is discovered! We then attempt: We obtain a certificate that allows us to authenticate as Administrator \ud83d\ude08 And there we have an Administrator TGT. The key to the kingdom.","title":"7. PrivEsc \u2013 Privilege Escalation via Certificates \ud83e\udde9"},{"location":"TryHackMe/ledger/#8-admin-connection-the-loop-is-closed","text":"With a valid TGT, a wmiexec.py from Impacket gives us a direct shell as admin: And the Grail awaits us!","title":"8. Admin Connection \u2013 The Loop is Closed"},{"location":"TryHackMe/ledger/#conclusion","text":"This challenge is an excellent example of a realistic Active Directory scenario: Passive reconnaissance (DNS, LDAP, Nmap) Exploitation of bad practices (default passwords) Escalation via ADCS (Active Directory Certificate Services)","title":"Conclusion"},{"location":"TryHackMe/ledger/#francais","text":"Cat\u00e9gorie : Active Directory Plateforme : TryHackMe Objectif : La machine Ledger simule un environnement Active Directory dans lequel l\u2019attaquant doit \u00e9num\u00e9rer des utilisateurs via LDAP, exploiter des mots de passe par d\u00e9faut pour obtenir un premier acc\u00e8s utilisateur, puis \u00e9lever ses privil\u00e8ges en abusant d\u2019une mauvaise configuration d\u2019Active Directory Certificate Services (ADCS). L\u2019objectif final est d\u2019obtenir un certificat permettant de s\u2019authentifier comme Administrator .","title":"Fran\u00e7ais"},{"location":"TryHackMe/ledger/#1-scan-nmap-que-nous-reserve-linfrastructure","text":"Avant de sauter sur les outils les plus sexy, on reste sobre : un bon vieux scan Nmap pour poser les fondations de notre compr\u00e9hension. nmap -sC -sV -Pn -T4 -p- <IP>","title":"1. Scan Nmap \u2013 Que nous r\u00e9serve l'infrastructure ?"},{"location":"TryHackMe/ledger/#11-exegol-history_1","text":"exegol-history est un m\u00e9canisme ou module souvent utilis\u00e9 dans l\u2019environnement Exegol, un conteneur Docker offensif con\u00e7u pour les pentesters et Red Teamers. Il permet, entre autres, de personnaliser la session de travail dans le conteneur, notamment via le chargement de variables d\u2019environnement d\u00e8s l\u2019ouverture d\u2019un terminal Exegol. L\u2019int\u00e9r\u00eat principal est de pr\u00e9-configurer automatiquement des variables sensibles ou utiles \u00e0 chaque engagement, comme : TARGET : nom ou IP de la cible DOMAIN : domaine Active Directory attaqu\u00e9 USERNAME : compte compromis durant le pentest PASSWORD : mot de passe du compte associ\u00e9 ... Cela \u00e9vite de devoir les retaper \u00e0 chaque fois, permet de les utiliser dans des scripts ou des outils (NetExec, Impacket, etc.), et standardise l\u2019environnement d\u2019un op\u00e9rateur \u00e0 l\u2019autre.","title":"1.1 Exegol-history"},{"location":"TryHackMe/ledger/#ports-ouverts-analyse-initiale","text":"Voici les ports d\u00e9tect\u00e9s par Nmap, avec une analyse rapide des opportunit\u00e9s potentielles : Port Service Interpr\u00e9tation / Action 53 DNS \ud83d\udd0e Zone transfer \u00e0 tester 80 HTTP \ud83c\udf10 Investigation web (site classique ?) 88 Kerberos \ud83d\udd13 ASREPRoasting si usernames connus 135 RPC \ud83d\udce4 Enum\u00e9ration via rpcdump 139 NetBIOS \ud83d\udcc2 Enum\u00e9ration avec smbmap / enum4linux 445 SMB \ud83d\udcc2 Possibles partages, droits, Enum SMB 389 LDAP \ud83e\uddec ldapsearch pour extraire des comptes 443 HTTPS \ud83c\udf10 Version s\u00e9curis\u00e9e du site , \u00e0 fouiller 3389 RDP \ud83d\udd10 Acc\u00e8s distant si compte valide On fuite: - Le Domain name --> thm.local - Le FQDN de la machine --> labyrinth.thm.local","title":"\ud83d\udce1 Ports ouverts \u2013 Analyse initiale"},{"location":"TryHackMe/ledger/#2-dns-peut-on-aspirer-des-infos-facilement","text":"Un petit test de zone transfer, souvent n\u00e9glig\u00e9 mais parfois tr\u00e8s parlant : \u274c \u00c9chec. Pas grave, on poursuit notre chasse aux infos ailleurs.","title":"2. DNS \u2013 Peut-on aspirer des infos facilement ?"},{"location":"TryHackMe/ledger/#3-httphttps-espoir-sur-le-web","text":"Direction le port 80 (HTTP) puis 443 (HTTPS). L\u2019acc\u00e8s renvoie une page par d\u00e9faut IIS.","title":"3. HTTP/HTTPS \u2013 Espoir sur le web ?"},{"location":"TryHackMe/ledger/#4-smbrpc-partages-juteux","text":"\u274c Rien d\u2019exploitable. On dirait qu\u2019il faut \u00eatre authentifi\u00e9 pour obtenir quelque chose. Revenons plus tard.","title":"4. SMB/RPC \u2013 Partages juteux ?"},{"location":"TryHackMe/ledger/#5-ldap-la-perle-rare","text":"On grep l'output avec description Puis en descendant un peu on remarque: On extrait les users associ\u00e9s \u00e0 ce mot de passe par d\u00e9faut \ud83d\udca5 Bingo ! Deux utilisateurs apparaissent avec le m\u00eame mot de passe par d\u00e9faut: IVY_WILLIS SUSANNA_MCKNIGHT","title":"5. LDAP \u2013 La perle rare ?"},{"location":"TryHackMe/ledger/#6-rdp-une-ouverture-vers-le-systeme","text":"On teste la possibilit\u00e9 que les users trouv\u00e9 pr\u00e9c\u00e9demment puissent se connecter en RDP: Puis on se connecte avec le user qui peut \u00e9tablir une session RDP avec la machine On r\u00e9cup\u00e8re le flag user.txt","title":"6. RDP \u2013 Une ouverture vers le syst\u00e8me ?"},{"location":"TryHackMe/ledger/#7-privesc-lescalade-par-les-certificats","text":"On explore les groupes auxquels Susanna appartient et\u2026 oh : Certificate Service DCOM Access \ud83e\udde0 R\u00e9fl\u00e9chis : Cela te donne-t-il un levier sur les services de certificats Windows ? Tu peux peut-\u00eatre demander un certificat d\u2019authentification machine... Utilisation de Certipy, un outil redoutable pour cet univers : Un template vuln\u00e9rable est d\u00e9couvert ! On tente alors : On obtient un certificat qui permet de s\u2019authentifier comme Administrator \ud83d\ude08 Et voil\u00e0 un TGT Administrator en poche. La cl\u00e9 du royaume.","title":"7. PrivEsc \u2013 L\u2019escalade par les certificats \ud83e\udde9"},{"location":"TryHackMe/ledger/#8-connexion-admin-la-boucle-est-bouclee","text":"Avec un TGT valide, un wmiexec.py de Impacket nous donne un shell direct en tant qu\u2019admin : Et le Graal nous attend !","title":"8. Connexion Admin \u2013 La boucle est boucl\u00e9e"},{"location":"TryHackMe/ledger/#conclusion_1","text":"Ce challenge est un excellent exemple d\u2019un sc\u00e9nario r\u00e9aliste d'Active Directory : Reconnaissance passive (DNS, LDAP, Nmap) Exploitation de mauvaises pratiques (mots de passe par d\u00e9faut) Escalade via ADCS (Active Directory Certificate Services)","title":"Conclusion"},{"location":"TryHackMe/reset/","text":"\ud83c\uddeb\ud83c\uddf7 Version fran\u00e7aise | \ud83c\uddec\ud83c\udde7 English version English Category: Active Directory Platform: TryHackMe Objective: Gain access to a Domain Admin account on a Windows machine by analyzing the Active Directory infrastructure, capturing hashes, identifying attack paths, and exploiting misconfigured Kerberos delegation. 1. Initial Scan with Nmap As always, we start with basic mapping. What services are running on this machine? Which ports are exposed? We run a full scan with Nmap: nmap -sC -sV -Pn -T4 -p- \"\\$TARGET\" A few points to note here: Point Description Port 53 (DNS) is open Is a zone transfer possible? Port 88 (Kerberos) is accessible Could there be users vulnerable to AS-REP Roasting ? Ports 135 / 139 / 445 (RPC / SMB) Could give us access to shares RDP (3389) and WinRM (5985) Require credentials but become very useful once we have a foothold in the domain Note that the Nmap scan allowed us to leak: - The domain: thm.corp - The FQDN of the machine: HayStack.thm.corp 1.1 Exegol-history exegol-history is a mechanism or module often used in the Exegol environment, an offensive Docker container designed for pentesters and Red Teamers. It allows, among other things, customization of the working session in the container, particularly through the loading of environment variables as soon as an Exegol terminal is opened. The main benefit is the automatic pre-configuration of sensitive or useful variables for each engagement, such as: - TARGET: name or IP of the target - DOMAIN: Active Directory domain under attack - USERNAME: account compromised during the pentest - PASSWORD: password of the associated account - ... This avoids having to retype them each time, allows their use in scripts or tools (NetExec, Impacket, etc.), and standardizes the environment from one operator to another. 2. DNS Zone Transfer First reflex in the presence of DNS: test a zone transfer . Unfortunately, the operation fails. 3. SMB Enumeration Let's move on to the SMB ports. We use enum4linux to extract as much information as possible about the domain and shares. A share named Data is accessible. We confirm the presence and restrictions of this share with smbmap. A connection via smbclient allows browsing its contents. Strange thing: the file names change regularly. This suggests an automatic process in the background. Maybe a service account ? This behavior deserves to be provoked... and taken advantage of. 4. NTLM Hash Capture via Responder The goal here is to capture an NTLM hash via an SMB relay/capture attack. We generate trapped files with ntlm_theft (various extensions) We upload them to the share We launch Responder in listening mode When a service (such as an automated account) interacts with these files, it sends its credentials in NTLM format. At this stage, ask yourself the question: why is this service interacting with my files ? What role does it play in the AD environment ? 5. NTLM Hash Cracking and Initial Access Once the hash is retrieved, head to John the Ripper to brute force it. Once the password is discovered, an Evil-WinRM session allows connecting to the machine. First flag: user.txt . But above all, the first anchor point in the environment. It is time to look up and observe the AD infrastructure as a whole. 6. Active Directory Reconnaissance with BloodHound To analyze the Active Directory environment, we use BloodHound . This step is crucial to identify access relationships, implicit permissions, and misconfigurations. The steps: Launch Neo4j neo4j console Launch the BloodHound collector from the Imapcket suite Load the data into BloodHound and observe Questions to ask yourself here: - Who has access to what? - Which permissions can be abused? - Is there a path to higher privileges? 7. Lateral Movement via AS-REP Roasting BloodHound allows identifying accounts vulnerable to AS-REP Roasting . We identify three users who do not have pre-authentication enabled. This is an opportunity not to be missed. We retrieve the encrypted TGT tickets, then submit them to John the Ripper. A password is cracked. Think: Why don\u2019t these accounts have pre-authentication enabled? Is it negligence or a deliberate configuration? 8. Privilege Abuse via Reset Password By analyzing more deeply with BloodHound, we discover that the user whose password we just cracked has the right to reset the password of an account that, in turn, has the right to reset the password of another account, and so on. This is an escalation chain: 1. Reset the password of a first account 2. Use it to compromise another account 3. Repeat until you reach an interesting account 9. Kerberos Delegation (Constrained) The last obtained account has AllowedToDelegateTo delegation rights. This is known as constrained Kerberos delegation , and it is particularly dangerous if misconfigured. With these rights, it is possible to forge a Service Ticket for the cifs service on behalf of Administrator . 10. Access to the Administrator Account The ST is forged and exported as an environment variable. All that remains is to connect using wmiexec.py or an equivalent tool. We gain access to the machine with Domain Admin rights. And we retrieve the final flag: root.txt . \ud83c\udfaf Final Thought: This machine clearly shows how several small combined weaknesses (AS-REP Roasting, poorly managed permissions, Kerberos delegation) can lead to a full domain compromise. Each step may not be critical on its own, but together, they pave the way to full escalation. Fran\u00e7ais Cat\u00e9gorie : Active Directory Plateforme : TryHackMe Objectif : Acc\u00e9der \u00e0 un compte Domain Admin sur une machine Windows en analysant l'infrastructure Active Directory, capturant des hash, identifiant les chemins d'attaque et exploitant les mauvaises configurations de d\u00e9l\u00e9gation Kerberos. 1. Scan initial avec Nmap Comme toujours, on commence par une cartographie de base. Quels services tournent sur cette machine ? Quels ports sont expos\u00e9s ? On ex\u00e9cute un scan complet avec Nmap : nmap -sC -sV -Pn -T4 -p- \"$TARGET\" Quelques points \u00e0 noter ici : Le port 53 (DNS) est ouvert. Est-ce qu\u2019un transfert de zone est possible ? Le port 88 (Kerberos) est accessible. Pourrait-il y avoir des utilisateurs vuln\u00e9rables au AS-REP Roasting ? Les ports 135 / 139 / 445 (RPC / SMB) pourraient nous donner acc\u00e8s \u00e0 des partages. Le RDP (3389) et WinRM (5985) n\u00e9cessitent des identifiants, mais deviennent tr\u00e8s utiles une fois qu\u2019on a un pied dans le domaine. A noter que le scan nmap nous a permis de fuiter: - le domain : thm.corp - le FQDN de la machine: HayStack.thm.corp 1.1 Exegol-history exegol-history est un m\u00e9canisme ou module souvent utilis\u00e9 dans l\u2019environnement Exegol, un conteneur Docker offensif con\u00e7u pour les pentesters et Red Teamers. Il permet, entre autres, de personnaliser la session de travail dans le conteneur, notamment via le chargement de variables d\u2019environnement d\u00e8s l\u2019ouverture d\u2019un terminal Exegol. L\u2019int\u00e9r\u00eat principal est de pr\u00e9-configurer automatiquement des variables sensibles ou utiles \u00e0 chaque engagement, comme : TARGET : nom ou IP de la cible DOMAIN : domaine Active Directory attaqu\u00e9 USERNAME : compte compromis durant le pentest PASSWORD : mot de passe du compte associ\u00e9 ... Cela \u00e9vite de devoir les retaper \u00e0 chaque fois, permet de les utiliser dans des scripts ou des outils (NetExec, Impacket, etc.), et standardise l\u2019environnement d\u2019un op\u00e9rateur \u00e0 l\u2019autre. 2. Transfert de zone DNS Premier r\u00e9flexe en pr\u00e9sence de DNS : tester un zone transfer . Malheureusement, l\u2019op\u00e9ration \u00e9choue. 3. \u00c9num\u00e9ration SMB Passons aux ports SMB. On utilise enum4linux pour extraire un maximum d\u2019informations sur le domaine et les partages. Un partage nomm\u00e9 Data est accessible. On confirme la pr\u00e9sence et les restrictions de ce partage ave smbmap Une connexion via smbclient permet de parcourir son contenu. Chose \u00e9trange : les noms de fichiers changent r\u00e9guli\u00e8rement. Cela \u00e9voque un processus automatique en arri\u00e8re-plan. Peut-\u00eatre un compte de service ? Ce comportement m\u00e9rite qu'on le provoque... et qu'on en profite. 4. Capture de hash NTLM via Responder L\u2019objectif ici est de capturer un hash NTLM via une attaque de type SMB relay / capture . On g\u00e9n\u00e8re des fichiers pi\u00e9g\u00e9s avec ntlm_theft (diverses extensions) On les upload dans le partage On lance Responder en \u00e9coute Quand un service (comme un compte automatis\u00e9) interagit avec ces fichiers, il envoie ses identifiants au format NTLM. \u00c0 ce stade, pose-toi la question : pourquoi ce service interagit-il avec mes fichiers ? Quel r\u00f4le joue-t-il dans l\u2019environnement AD ? 5. Crackage du hash NTLM et acc\u00e8s initial Une fois le hash r\u00e9cup\u00e9r\u00e9, direction John the Ripper pour le bruteforce. Une fois le mot de passe d\u00e9couvert, une session Evil-WinRM permet de se connecter \u00e0 la machine. Premier drapeau : user.txt . Mais surtout, premier point d\u2019ancrage dans l\u2019environnement. Il est temps de lever la t\u00eate et d\u2019observer l\u2019infrastructure AD dans son ensemble. 6. Reconnaissance Active Directory avec BloodHound Pour analyser l\u2019environnement Active Directory, on utilise BloodHound . Cette \u00e9tape est cruciale pour identifier les relations d\u2019acc\u00e8s, les permissions implicites et les mauvaises configurations. Les \u00e9tapes : Lancer Neo4j neo4j console Lancer le collecteur BloodHound de la suite Imapcket Charger les donn\u00e9es dans BloodHound et observer Questions \u00e0 se poser ici : - Qui a acc\u00e8s \u00e0 quoi ? - Quelles permissions sont abusables ? - Existe-t-il un chemin vers des privil\u00e8ges plus \u00e9lev\u00e9s ? 7. Mouvement lat\u00e9ral via AS-REP Roasting BloodHound permet d'identifier les comptes vuln\u00e9rables \u00e0 AS-REP Roasting . On rep\u00e8re trois utilisateurs qui n\u2019ont pas la pr\u00e9-authentification activ\u00e9e. C\u2019est une opportunit\u00e9 \u00e0 ne pas rater. On r\u00e9cup\u00e8re les tickets TGT chiffr\u00e9s, puis on les soumet \u00e0 John the Ripper. Un mot de passe tombe. R\u00e9fl\u00e9chis : Pourquoi ces comptes n\u2019ont-ils pas de pr\u00e9-authentification ? Est-ce une n\u00e9gligence ou une configuration volontaire ? 8. Abus de privil\u00e8ges via Reset Password En analysant plus profond\u00e9ment avec BloodHound, on d\u00e9couvre que l'utilisateur dont on vient de cracker le mot de passe a le droit de r\u00e9initialiser le mot de passe d'un compte qui a son toura le droit de r\u00e9initialiser le mot de passe d'un compte, etc. C\u2019est une cha\u00eene d\u2019escalade : 1. R\u00e9initialiser le mot de passe d\u2019un premier compte 2. S\u2019en servir pour en compromettre un autre 3. R\u00e9p\u00e9ter jusqu\u2019\u00e0 tomber sur un compte int\u00e9ressant 9. D\u00e9l\u00e9gation Kerberos (contrainte) Le dernier compte obtenu poss\u00e8de des droits de d\u00e9l\u00e9gation AllowedToDelegateTo . C\u2019est ce qu\u2019on appelle de la d\u00e9l\u00e9gation Kerberos contrainte , et c\u2019est particuli\u00e8rement dangereux si mal configur\u00e9. Avec ces droits, il est possible de forger un Service Ticket pour le service cifs au nom de Administrator . 10. Acc\u00e8s au compte Administrator Le ST est forg\u00e9 et export\u00e9 comme variable d\u2019environnement. Il ne reste plus qu\u2019\u00e0 se connecter avec wmiexec.py ou un \u00e9quivalent. On acc\u00e8de \u00e0 la machine avec les droits Domain Admin . Et on r\u00e9cup\u00e8re le flag final : root.txt . \ud83c\udfaf R\u00e9flexion finale : Cette machine montre bien comment plusieurs petites faiblesses combin\u00e9es (AS-REP Roasting, permissions mal ma\u00eetris\u00e9es, d\u00e9l\u00e9gation Kerberos) peuvent conduire \u00e0 une compromission compl\u00e8te du domaine. Chaque \u00e9tape n\u2019est pas forc\u00e9ment critique seule, mais ensemble, elles ouvrent un chemin vers l\u2019escalade maximale.","title":"Reset"},{"location":"TryHackMe/reset/#english","text":"Category: Active Directory Platform: TryHackMe Objective: Gain access to a Domain Admin account on a Windows machine by analyzing the Active Directory infrastructure, capturing hashes, identifying attack paths, and exploiting misconfigured Kerberos delegation.","title":"English"},{"location":"TryHackMe/reset/#1-initial-scan-with-nmap","text":"As always, we start with basic mapping. What services are running on this machine? Which ports are exposed? We run a full scan with Nmap: nmap -sC -sV -Pn -T4 -p- \"\\$TARGET\" A few points to note here: Point Description Port 53 (DNS) is open Is a zone transfer possible? Port 88 (Kerberos) is accessible Could there be users vulnerable to AS-REP Roasting ? Ports 135 / 139 / 445 (RPC / SMB) Could give us access to shares RDP (3389) and WinRM (5985) Require credentials but become very useful once we have a foothold in the domain Note that the Nmap scan allowed us to leak: - The domain: thm.corp - The FQDN of the machine: HayStack.thm.corp","title":"1. Initial Scan with Nmap"},{"location":"TryHackMe/reset/#11-exegol-history","text":"exegol-history is a mechanism or module often used in the Exegol environment, an offensive Docker container designed for pentesters and Red Teamers. It allows, among other things, customization of the working session in the container, particularly through the loading of environment variables as soon as an Exegol terminal is opened. The main benefit is the automatic pre-configuration of sensitive or useful variables for each engagement, such as: - TARGET: name or IP of the target - DOMAIN: Active Directory domain under attack - USERNAME: account compromised during the pentest - PASSWORD: password of the associated account - ... This avoids having to retype them each time, allows their use in scripts or tools (NetExec, Impacket, etc.), and standardizes the environment from one operator to another.","title":"1.1 Exegol-history"},{"location":"TryHackMe/reset/#2-dns-zone-transfer","text":"First reflex in the presence of DNS: test a zone transfer . Unfortunately, the operation fails.","title":"2. DNS Zone Transfer"},{"location":"TryHackMe/reset/#3-smb-enumeration","text":"Let's move on to the SMB ports. We use enum4linux to extract as much information as possible about the domain and shares. A share named Data is accessible. We confirm the presence and restrictions of this share with smbmap. A connection via smbclient allows browsing its contents. Strange thing: the file names change regularly. This suggests an automatic process in the background. Maybe a service account ? This behavior deserves to be provoked... and taken advantage of.","title":"3. SMB Enumeration"},{"location":"TryHackMe/reset/#4-ntlm-hash-capture-via-responder","text":"The goal here is to capture an NTLM hash via an SMB relay/capture attack. We generate trapped files with ntlm_theft (various extensions) We upload them to the share We launch Responder in listening mode When a service (such as an automated account) interacts with these files, it sends its credentials in NTLM format. At this stage, ask yourself the question: why is this service interacting with my files ? What role does it play in the AD environment ?","title":"4. NTLM Hash Capture via Responder"},{"location":"TryHackMe/reset/#5-ntlm-hash-cracking-and-initial-access","text":"Once the hash is retrieved, head to John the Ripper to brute force it. Once the password is discovered, an Evil-WinRM session allows connecting to the machine. First flag: user.txt . But above all, the first anchor point in the environment. It is time to look up and observe the AD infrastructure as a whole.","title":"5. NTLM Hash Cracking and Initial Access"},{"location":"TryHackMe/reset/#6-active-directory-reconnaissance-with-bloodhound","text":"To analyze the Active Directory environment, we use BloodHound . This step is crucial to identify access relationships, implicit permissions, and misconfigurations. The steps: Launch Neo4j neo4j console Launch the BloodHound collector from the Imapcket suite Load the data into BloodHound and observe Questions to ask yourself here: - Who has access to what? - Which permissions can be abused? - Is there a path to higher privileges?","title":"6. Active Directory Reconnaissance with BloodHound"},{"location":"TryHackMe/reset/#7-lateral-movement-via-as-rep-roasting","text":"BloodHound allows identifying accounts vulnerable to AS-REP Roasting . We identify three users who do not have pre-authentication enabled. This is an opportunity not to be missed. We retrieve the encrypted TGT tickets, then submit them to John the Ripper. A password is cracked. Think: Why don\u2019t these accounts have pre-authentication enabled? Is it negligence or a deliberate configuration?","title":"7. Lateral Movement via AS-REP Roasting"},{"location":"TryHackMe/reset/#8-privilege-abuse-via-reset-password","text":"By analyzing more deeply with BloodHound, we discover that the user whose password we just cracked has the right to reset the password of an account that, in turn, has the right to reset the password of another account, and so on. This is an escalation chain: 1. Reset the password of a first account 2. Use it to compromise another account 3. Repeat until you reach an interesting account","title":"8. Privilege Abuse via Reset Password"},{"location":"TryHackMe/reset/#9-kerberos-delegation-constrained","text":"The last obtained account has AllowedToDelegateTo delegation rights. This is known as constrained Kerberos delegation , and it is particularly dangerous if misconfigured. With these rights, it is possible to forge a Service Ticket for the cifs service on behalf of Administrator .","title":"9. Kerberos Delegation (Constrained)"},{"location":"TryHackMe/reset/#10-access-to-the-administrator-account","text":"The ST is forged and exported as an environment variable. All that remains is to connect using wmiexec.py or an equivalent tool. We gain access to the machine with Domain Admin rights. And we retrieve the final flag: root.txt . \ud83c\udfaf Final Thought: This machine clearly shows how several small combined weaknesses (AS-REP Roasting, poorly managed permissions, Kerberos delegation) can lead to a full domain compromise. Each step may not be critical on its own, but together, they pave the way to full escalation.","title":"10. Access to the Administrator Account"},{"location":"TryHackMe/reset/#francais","text":"Cat\u00e9gorie : Active Directory Plateforme : TryHackMe Objectif : Acc\u00e9der \u00e0 un compte Domain Admin sur une machine Windows en analysant l'infrastructure Active Directory, capturant des hash, identifiant les chemins d'attaque et exploitant les mauvaises configurations de d\u00e9l\u00e9gation Kerberos.","title":"Fran\u00e7ais"},{"location":"TryHackMe/reset/#1-scan-initial-avec-nmap","text":"Comme toujours, on commence par une cartographie de base. Quels services tournent sur cette machine ? Quels ports sont expos\u00e9s ? On ex\u00e9cute un scan complet avec Nmap : nmap -sC -sV -Pn -T4 -p- \"$TARGET\" Quelques points \u00e0 noter ici : Le port 53 (DNS) est ouvert. Est-ce qu\u2019un transfert de zone est possible ? Le port 88 (Kerberos) est accessible. Pourrait-il y avoir des utilisateurs vuln\u00e9rables au AS-REP Roasting ? Les ports 135 / 139 / 445 (RPC / SMB) pourraient nous donner acc\u00e8s \u00e0 des partages. Le RDP (3389) et WinRM (5985) n\u00e9cessitent des identifiants, mais deviennent tr\u00e8s utiles une fois qu\u2019on a un pied dans le domaine. A noter que le scan nmap nous a permis de fuiter: - le domain : thm.corp - le FQDN de la machine: HayStack.thm.corp","title":"1. Scan initial avec Nmap"},{"location":"TryHackMe/reset/#11-exegol-history_1","text":"exegol-history est un m\u00e9canisme ou module souvent utilis\u00e9 dans l\u2019environnement Exegol, un conteneur Docker offensif con\u00e7u pour les pentesters et Red Teamers. Il permet, entre autres, de personnaliser la session de travail dans le conteneur, notamment via le chargement de variables d\u2019environnement d\u00e8s l\u2019ouverture d\u2019un terminal Exegol. L\u2019int\u00e9r\u00eat principal est de pr\u00e9-configurer automatiquement des variables sensibles ou utiles \u00e0 chaque engagement, comme : TARGET : nom ou IP de la cible DOMAIN : domaine Active Directory attaqu\u00e9 USERNAME : compte compromis durant le pentest PASSWORD : mot de passe du compte associ\u00e9 ... Cela \u00e9vite de devoir les retaper \u00e0 chaque fois, permet de les utiliser dans des scripts ou des outils (NetExec, Impacket, etc.), et standardise l\u2019environnement d\u2019un op\u00e9rateur \u00e0 l\u2019autre.","title":"1.1 Exegol-history"},{"location":"TryHackMe/reset/#2-transfert-de-zone-dns","text":"Premier r\u00e9flexe en pr\u00e9sence de DNS : tester un zone transfer . Malheureusement, l\u2019op\u00e9ration \u00e9choue.","title":"2. Transfert de zone DNS"},{"location":"TryHackMe/reset/#3-enumeration-smb","text":"Passons aux ports SMB. On utilise enum4linux pour extraire un maximum d\u2019informations sur le domaine et les partages. Un partage nomm\u00e9 Data est accessible. On confirme la pr\u00e9sence et les restrictions de ce partage ave smbmap Une connexion via smbclient permet de parcourir son contenu. Chose \u00e9trange : les noms de fichiers changent r\u00e9guli\u00e8rement. Cela \u00e9voque un processus automatique en arri\u00e8re-plan. Peut-\u00eatre un compte de service ? Ce comportement m\u00e9rite qu'on le provoque... et qu'on en profite.","title":"3. \u00c9num\u00e9ration SMB"},{"location":"TryHackMe/reset/#4-capture-de-hash-ntlm-via-responder","text":"L\u2019objectif ici est de capturer un hash NTLM via une attaque de type SMB relay / capture . On g\u00e9n\u00e8re des fichiers pi\u00e9g\u00e9s avec ntlm_theft (diverses extensions) On les upload dans le partage On lance Responder en \u00e9coute Quand un service (comme un compte automatis\u00e9) interagit avec ces fichiers, il envoie ses identifiants au format NTLM. \u00c0 ce stade, pose-toi la question : pourquoi ce service interagit-il avec mes fichiers ? Quel r\u00f4le joue-t-il dans l\u2019environnement AD ?","title":"4. Capture de hash NTLM via Responder"},{"location":"TryHackMe/reset/#5-crackage-du-hash-ntlm-et-acces-initial","text":"Une fois le hash r\u00e9cup\u00e9r\u00e9, direction John the Ripper pour le bruteforce. Une fois le mot de passe d\u00e9couvert, une session Evil-WinRM permet de se connecter \u00e0 la machine. Premier drapeau : user.txt . Mais surtout, premier point d\u2019ancrage dans l\u2019environnement. Il est temps de lever la t\u00eate et d\u2019observer l\u2019infrastructure AD dans son ensemble.","title":"5. Crackage du hash NTLM et acc\u00e8s initial"},{"location":"TryHackMe/reset/#6-reconnaissance-active-directory-avec-bloodhound","text":"Pour analyser l\u2019environnement Active Directory, on utilise BloodHound . Cette \u00e9tape est cruciale pour identifier les relations d\u2019acc\u00e8s, les permissions implicites et les mauvaises configurations. Les \u00e9tapes : Lancer Neo4j neo4j console Lancer le collecteur BloodHound de la suite Imapcket Charger les donn\u00e9es dans BloodHound et observer Questions \u00e0 se poser ici : - Qui a acc\u00e8s \u00e0 quoi ? - Quelles permissions sont abusables ? - Existe-t-il un chemin vers des privil\u00e8ges plus \u00e9lev\u00e9s ?","title":"6. Reconnaissance Active Directory avec BloodHound"},{"location":"TryHackMe/reset/#7-mouvement-lateral-via-as-rep-roasting","text":"BloodHound permet d'identifier les comptes vuln\u00e9rables \u00e0 AS-REP Roasting . On rep\u00e8re trois utilisateurs qui n\u2019ont pas la pr\u00e9-authentification activ\u00e9e. C\u2019est une opportunit\u00e9 \u00e0 ne pas rater. On r\u00e9cup\u00e8re les tickets TGT chiffr\u00e9s, puis on les soumet \u00e0 John the Ripper. Un mot de passe tombe. R\u00e9fl\u00e9chis : Pourquoi ces comptes n\u2019ont-ils pas de pr\u00e9-authentification ? Est-ce une n\u00e9gligence ou une configuration volontaire ?","title":"7. Mouvement lat\u00e9ral via AS-REP Roasting"},{"location":"TryHackMe/reset/#8-abus-de-privileges-via-reset-password","text":"En analysant plus profond\u00e9ment avec BloodHound, on d\u00e9couvre que l'utilisateur dont on vient de cracker le mot de passe a le droit de r\u00e9initialiser le mot de passe d'un compte qui a son toura le droit de r\u00e9initialiser le mot de passe d'un compte, etc. C\u2019est une cha\u00eene d\u2019escalade : 1. R\u00e9initialiser le mot de passe d\u2019un premier compte 2. S\u2019en servir pour en compromettre un autre 3. R\u00e9p\u00e9ter jusqu\u2019\u00e0 tomber sur un compte int\u00e9ressant","title":"8. Abus de privil\u00e8ges via Reset Password"},{"location":"TryHackMe/reset/#9-delegation-kerberos-contrainte","text":"Le dernier compte obtenu poss\u00e8de des droits de d\u00e9l\u00e9gation AllowedToDelegateTo . C\u2019est ce qu\u2019on appelle de la d\u00e9l\u00e9gation Kerberos contrainte , et c\u2019est particuli\u00e8rement dangereux si mal configur\u00e9. Avec ces droits, il est possible de forger un Service Ticket pour le service cifs au nom de Administrator .","title":"9. D\u00e9l\u00e9gation Kerberos (contrainte)"},{"location":"TryHackMe/reset/#10-acces-au-compte-administrator","text":"Le ST est forg\u00e9 et export\u00e9 comme variable d\u2019environnement. Il ne reste plus qu\u2019\u00e0 se connecter avec wmiexec.py ou un \u00e9quivalent. On acc\u00e8de \u00e0 la machine avec les droits Domain Admin . Et on r\u00e9cup\u00e8re le flag final : root.txt . \ud83c\udfaf R\u00e9flexion finale : Cette machine montre bien comment plusieurs petites faiblesses combin\u00e9es (AS-REP Roasting, permissions mal ma\u00eetris\u00e9es, d\u00e9l\u00e9gation Kerberos) peuvent conduire \u00e0 une compromission compl\u00e8te du domaine. Chaque \u00e9tape n\u2019est pas forc\u00e9ment critique seule, mais ensemble, elles ouvrent un chemin vers l\u2019escalade maximale.","title":"10. Acc\u00e8s au compte Administrator"}]}